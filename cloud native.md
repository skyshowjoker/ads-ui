# 云原生
云原生这个词由来已久，已经不知道具体出处。15年的时候， Pivotal 公司提出了云原生应用的理念，然后这个概念就变得火起来了。也是那一年google成立了云原生计算基金会，算是一个比较中立的组织。越来越多的云计算供应商也加入了进去，到了18年，他们觉得旧的定义已经限制了云原生生态的发展，便进行了重定义。

CNCF 作为一个厂商中立的基金会，致力于 Github 上的快速成长的开源技术的推广，如 Kubernetes、Prometheus、Envoy 等。

不同的机构，企业对云原生都有不同的定义，普遍看来云原生是一种行为方式和设计理念
，笼统一点地说，本质上，凡是能够提高云上资源利用率和应用交付效率的行为方式都是云原生的。

---
## 云

### 大型机
这个图是上世纪六十年代的大型机，一台机器可能被几百个人同时使用。那个时候人们并不是面对面操作的这个机器，而是远程提交自己的任务然后等待计算结果，最后使用了多少资源付多少钱。
---
---
### 云计算
* 计算、网络、存储资源  
>时间灵活性：想什么时候要就什么时候要，需要的时候一点就出来了；  
>空间灵活性：想要多少就有多少。  


* 物理设备不灵活，于是有了虚拟技术  
* 虚拟化软件一般创建一台虚拟的电脑，但需要人为指定这台虚拟电脑放在哪台物理机上的。这一过程可能还需要比较复杂的人工配置。  
* 有一个调度中心，几千台机器都在一个池子里面，无论用户需要多少CPU、内存、硬盘的虚拟电脑，调度中心会自动在大池子里面找一个能够满足用户需求的地方，把虚拟电脑启动起来做好配置，用户就直接能用了。这个阶段我们称为池化或者云化
---
* 私有云：把虚拟化和云化的这套软件部署在别人的数据中心里面。使用私有云的用户往往很有钱，自己买地建机房、自己买服务器，然后让云厂商部署在自己这里。VMware后来除了虚拟化，也推出了云计算的产品，并且在私有云市场赚的盆满钵满。
* 公有云：把虚拟化和云化软件部署在云厂商自己数据中心里面的，用户不需要很大的投入，只要注册一个账号，就能在一个网页上点一下创建一台虚拟电脑。例如AWS即亚马逊的公有云；例如国内的阿里云、腾讯云、网易云等。

**云服务** --"即服务"型产品对于工作负载会变化的客户特别有吸引力，因为服务提供商可提供处理可扩展性和负载平衡所需的专业知识和工作量。
### IaaS
供应商提供虚拟化、存储、网络和服务器。
### PaaS
PaaS 主要面向开发人员，为用户提供一个平台，用来开发、运行和管理自己的应用，不需要构建和维护和流程相关的基础架构，可以专注于应用开发。  
IaaS的按需付费只是虚拟机维度的按时间计费以及弹性伸缩，并不能彻底做到按需付费，计算和内存资源都是预申请规划的，和服务的请求并发数并没有明确的关系，哪怕一段时间一个请求没有，资源还是依然占用。
### SaaS
SaaS 是一项通常通过 Web 浏览器将服务提供商管理的 Web 应用交付给用户的服务。
### FaaS
按照《福布斯》杂志的统计，在商业和企业数据中心的典型服务器仅提供5%～15%的平均最大处理能力的输出。  
开发者实现的服务端逻辑运行在无状态的计算容器中，它由事件触发， 完全被第三方管理，其业务层面的状态则被开发者使用的数据库和存储资源所记录。  
不需要关心服务器端的相关技术，比如按量计费的 PaaS 服务 。
FaaS 的本质上是以程序的快速启动来实现正真的按需运行，按需伸缩，以及高可用。冷启动毫秒级。  这种方式的优势很明显，按需运算，没有调用就几乎没有资源占用

---

## 微服务
配合云计算，实现极大的资源利用率，应用层面的细粒度化。
### 第一，它解决了复杂问题。
它把可能会变得庞大的单体应用分解成一套服务。虽然功能数量不变，但应用已经被分解成可管理的块或者服务。每个服务都有一个明确的边界定义方式，如远程过程调用（RPC）驱动或消息驱动 API。微服务架构模式强制一定程度的模块化，实际上，使用单体代码来实现是极其困难的。因此，使用微服务架构模式，个体服务能被更快地开发，并且易于理解和维护。
### 第二，这种架构使得每个服务都可以由一个团队独立专注开发。
开发者可以自由选择任何符合服务 API 契约的技术。当然，更多的组织是希望通过技术选型限制来避免完全混乱的状态。然而，这种自由意味着开发人员不再有可能在这种自由的新项目开始时使用过时的技术。当编写一个新服务时，他们可以选择当前的技术。此外，由于服务较小，使用当前技术重写旧服务将变得更加可行。
### 第三，微服务架构模式可以实现每个微服务独立部署。  
开发人员根本不需要去协调部署本地变更到服务。这些变更一经测试即可立即部署。比如，UI 团队可以执行 A/B 测试，并快速迭代 UI 变更。微服务架构模式使得持续部署成为可能。
最后，微服务架构模式使得每个服务能够独立扩展。你可以仅部署满足每个服务的容量和可用性约束的实例数目。此外，你可以使用与服务资源要求最匹配的硬件。

---
## 容器化
>海边码头里的集装箱是运载货物用的，它是一种按规格标准化的钢制箱子。集装箱的特色，在于它格式一致，并且可以层层重叠，所以可以大量放置在货运轮船中（而早期航运是没有集装箱概念的，那时候货物杂乱无章的放，很影响出货和运输效率）。有了集装箱，那么这就更加快捷方便的为生产商提供廉价的运输服务。

### 优点
* 极其轻量：只打包了必要的Bin/Lib；  
* 秒级部署：根据镜像的不同，容器的部署大概在毫秒与秒之间（比虚拟机强很多）；  
* 易于移植：标准件，一次构建，随处部署，所以可以实现弹性伸缩；  
  

当前，docker几乎是容器的代名词，很多人以为容器就是docker。  
任何技术出现都需要一个标准来规范它，不然各搞各的很容易导致技术实现的碎片化，出现大量的冲突和冗余。因此，在2015年，由Google，Docker、CoreOS、IBM、微软、红帽等厂商联合发起的OCI（Open Container Initiative）组织成立了，并于2016年4月推出了第一个开放容器标准。标准主要包括runtime运行时标准和image镜像标准。
## 编排与调度
### K8S
>Kubernetes，简称 k8s或者 “kube”，是一个开源的 Linux 容器自动化运维平台，它消除了容器化应用程序在部署、伸缩时涉及到的许多手动操作。
* Master（主节点）： 控制 Kubernetes 节点的机器，也是创建作业任务的地方。
* Node（节点）： 这些机器在 Kubernetes 主节点的控制下执行被分配的任务。
* Pod： 由一个或多个容器构成的集合，作为一个整体被部署到一个单一节点。同一个 pod 中的容器共享 IP 地址、进程间通讯（IPC）、主机名以及其它资源。Pod 将底层容器的网络和存储抽象出来，使得集群内的容器迁移更为便捷。
* Kubernetes API ： 与外部进行交互的接口。
* scheduler: 负责将 Pods 指派到节点上。 调度器基于约束和可用资源为调度队列中每个 Pod 确定适合它放置的节点。
* Replication controller（复制控制器）： 控制一个 pod 在集群上运行的实例数量。
* Service（服务）： 将服务内容与具体的 pod 分离。Kubernetes 服务代理负责自动将服务请求分发到正确的 pod 处，不管 pod 移动到集群中的什么位置，甚至可以被替换掉。
* Kubelet： 作为节点代理的进程，管理容器运行状态。
* kube-proxy： 节点的网络代理。可以执行简单的 TCP、UDP 和 SCTP 流转发
* kubectl： 这是 Kubernetes 的命令行配置工具。

---

### OpenShift
>Kubernetes 是开源的，所以没有正式的技术支持机构为你的商业业务提供支持。因为k8s是很复杂很难的，如果在生产环境使用 Kubernetes 时遇到问题，你恐怕不会太愉快，当然你的客户也不会太高兴。Kubernetes 也需要与网络、存储、安全、监控等其它服务集成才能作为一种综合性的基础设施服务

openshift是红帽的云开发平台即服务（PaaS），底层以Docker作为容器引擎驱动，以k8s作为容器编排引擎组件，openshift提供了开发语言、中间件、自动化流程工具及界面等元素，提供了一套完整的基于容器的应用云平台。  

OpenShift 采用分层架构，自下而上包含了以下几个层次：
基础架构层
容器引擎层
容器编排层
PaaS 服务层
界面及工具层  
Openshift在一个平台上贯通开发、测试、部署、运维的流程，实现高度的自动化，满足应用持续集成及持续交付和部署的需求；满足企业及组织对容器管理、容器编排的需求

---
## 服务网格
* 服务网格是一个软件层，用于处理应用程序中服务之间的所有通信。  
深色的是我们平时工作中接触最多的业务微服务，旁边蓝色的被称为边车（sidecar）服务，sidecar作为业务微服务的“代理”，处理与其他业务微服务sidecar之间的非功能需求，如网络通信、安全、监控、流量控制等。多个sidecar之间的连接和交互组成了“网格（mesh）”。  
* 服务网格会在每个 pod 中注入一个 sidecar 代理，该代理对应用程序来说是透明，所有应用程序间的流量都会通过它，所以对应用程序流量的控制都可以在服务网格中实现。  
* 代理充当组织网络和微服务之间的中间网关。所有进出该服务的流量都通过代理服务器路由。单个代理有时被称为 sidecar，因为它们是分开运行的，但在逻辑上位于每个服务旁边。这些代理一起构成了服务网格层。 
* 服务网格架构中有两个主要组成部分：控制面板和数据面板。  
Istio 是一个开源服务网格项目，设计为主要与 Kubernetes 配合使用。


